%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User input Start
BC_T = {...
   'x', 0, 'u', 0
   'x', 2, 'u', 0.1
   'y', 0, 'v', 0
   'z', 0, 'w', 0};

FORCE_Tx = {'x', 0, 'u', 0};

NR_tol = 1e-10;%1e-11;
max_iter = 100;%20
n_steps = 1;
eltype = 'T10';
ndm = 3;
ngp = 4;
nen = 10;
plot = 0;

nodes = [...
0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	0	.5	1	1.5	2	1	1	1	1	1	1	1	0	0	0	.5	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	0	0	.5	.5	.5	.5	.5	1	1	1	1	1	1	1	1	1	1	0	0	0	.5	1	1	1	1	1	1	1	1	1	1	1	0	0	.5	.5	.5	.5	.5	1	1	1	1	1	0	0	0	0	0	0	0	0	0	0	0	.5	.5	.5	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	0	0	.5	.5	.5	.5	.5	1	1	1	1	1	0	0	0	0	0	0	0	.5	1	1	1	1	1	1	1	1	1	1	1	2	1.5	2	1.5	1.5	1.5	2	2	2	1.5	1.5	2	2	2	1.5	1.5	2	2	2	1.5	1.5	1.5	2	1.5	1.5	2	1.5	2	1.5	1.5	1.5	2	2	2	2	2	1.5	1.5	2	2	2	1.5	1.5	2	2	1.5	2	1.5	1.5	1.5	0	0	0	.5	.5	0	0	.5	.5	1	0	1	.5	.5	0	1	0	1	.5	0	.5	.5	2	1	1.5	1.5	1	1	2	2	1	2	1.5	1.5	1	2	1	1	1.5	1	1.5	1.5	1	1	2	2	1	2	1.5	1.5	2	2	1	2	1.5	1.5	1	2	2	1	2	1.5	1	1.5	1.5	0	0	.5	0	0	0	.5	.5	0	1	0	1	.5	.5	1	0	1	.5	.5	0	1	0	.5	1	.5	0	.5	.5	2	1	1.5	1.5	1	1.5	1	2	2	1	2	1.5	1.5	1	2	1	1	1.5	1	1.5	1.5	1	1	2	2	2	1	2	2	1.5	1.5	2	2	1	2	1.5	1.5	1	2	2	1	1.5	2	1.5	1	1.5	1.5	0	.5	0	.5	0	.5	0	.5	.5	.5	.5	.5	.5	0	.5	.5	.5	.5	.5
0	0	0	0	0	0.25	0.25	0.25	0.25	0.25	.5	.5	.5	.5	.5	0.75	0.75	0.75	0.75	0.75	1	1	1	1	1	0	0	0	0	0	0.25	0.25	0.25	0.25	0.25	.5	.5	.5	.5	.5	0.75	0.75	0.75	0.75	0.75	1	1	1	1	1	0	0	0	0	0	0.25	0.25	0.25	0.25	0.25	.5	.5	.5	.5	.5	0.75	0.75	0.75	0.75	0.75	1	1	1	1	1	0	0	0	0	0	0.25	0.25	0.25	0.25	0.25	.5	.5	.5	.5	.5	0.75	0.75	0.75	0.75	0.75	1	1	1	1	1	0	0	0	0	0	0.25	0.25	0.25	0.25	0.25	.5	.5	.5	.5	.5	0.75	0.75	0.75	0.75	0.75	1	1	1	1	1	0	0	0	0	0	0.25	0.25	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	0.75	0.75	1	1	1	1	1	0	0	0.25	0.25	0.25	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	0.75	0.75	0.75	1	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0.25	0.25	0.25	0.25	0.25	0.25	0.25	0.25	0.25	0.25	0.25	0.25	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	.5	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	1	0	0.25	0	0.25	0	0.25	0	.5	0.25	0.25	.5	.5	0	0.25	.5	0.25	0	0	0	0	0.25	0.25	.5	.5	.5	.5	0.75	.5	0.75	.5	0.75	.5	.5	1	.5	0.75	0.75	1	1	.5	0.75	1	0.75	.5	.5	.5	.5	.5	0.75	0.75	0	.5	0.25	0	0.25	.5	.5	0.25	.5	0	.5	0.25	.5	0.25	0	0	.5	0	0	0.25	0.25	0.25	0	0	0	0.25	0	0.25	0	.5	.5	0.25	.5	0.25	.5	0	0	.5	0.25	0.25	0	0.25	.5	0.25	0	.5	.5	0.25	0.25	.5	.5	0	.5	0.25	.5	0.25	0	0	0	.5	0	0	0.25	0.25	0.25	.5	.5	.5	.5	1	0.75	.5	0.75	1	.5	1	.5	0.75	1	.5	1	0.75	1	0.75	.5	.5	1	.5	.5	.5	0.75	0.75	0.75	.5	.5	.5	0.75	.5	.5	0.75	.5	1	1	0.75	1	0.75	1	.5	.5	1	0.75	0.75	.5	0.75	1	0.75	.5	.5	1	1	.5	0.75	0.75	1	1	.5	1	0.75	1	0.75	.5	.5	.5	1	.5	.5	.5	0.75	0.75	0.75	1	0.75	1	0.75	0.75	0.75	1	0.75	1	1	0.75	0.25	0.25	0.25	0	0.25	0.25	0	0.25
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	2.25	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	3	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0.75	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	1.5	0	0	0	0	0.75	0.75	0	0	0	0.75	0.75	0	1.5	0.75	0.75	1.5	1.5	0	0.75	0.75	1.5	0.75	0	0	0.75	0	0	0	0	0.75	0.75	0	1.5	0	0.75	0	0.75	0.75	0	1.5	0.75	0.75	1.5	1.5	0	1.5	0.75	0.75	1.5	0.75	3	3	2.25	2.25	2.25	2.25	3	2.25	2.25	3	3	2.25	2.25	3	3	3	3	2.25	2.25	3	3	2.25	1.5	3	1.5	1.5	2.25	2.25	1.5	1.5	3	1.5	1.5	1.5	2.25	1.5	3	3	1.5	2.25	2.25	2.25	2.25	3	1.5	1.5	3	1.5	2.25	2.25	1.5	3	3	2.25	2.25	3	3	3	1.5	3	2.25	2.25	3	3	2.25	3	2.25	2.25	3	3	2.25	2.25	2.25	2.25	3	3	2.25	2.25	2.25	3	3	2.25	2.25	3	3	3	3	3	2.25	2.25	3	3	2.25	1.5	3	1.5	1.5	2.25	2.25	2.25	1.5	1.5	3	1.5	1.5	1.5	2.25	1.5	3	3	1.5	2.25	2.25	2.25	2.25	3	1.5	3	1.5	3	2.25	1.5	2.25	2.25	1.5	3	3	2.25	2.25	3	3	3	1.5	3	3	2.25	2.25	3	3	2.25	0	0	0	0	0.75	0.75	0.75	0.75	0.75	0.75	0.75	0	0	0.75	0.75	0.75	0.75	0.75	0.75]';

elements = [...
1	126	127	128	138	178	130	272	274	278	283	185	135	143	144	145	151	210	147	297	299	303	310	228	179	187	188	189	231	336	191	350	357	366	372	378	214	236	237	238	268	406	240	422	429	438	446	452	5	15	218	272	219	55	278	284	221	185	294	261	297	262	304	303	311	228	186	229	111	187	323	103	189	189	332	231	344	351	352	350	359	105	366	374	235	121	236	391	396	238	238	268	415	424	422	431	439	438	145	224	151	210	142	71	143	253	223	145	128	181	138	178	13	206	3	61	126	204	53	128
3	13	134	53	181	182	5	15	141	55	284	288	142	23	464	223	224	225	294	25	154	304	311	315	186	229	213	103	331	337	344	351	234	105	373	379	235	266	259	396	401	407	415	423	271	439	447	453	183	218	272	218	274	220	220	221	283	222	226	297	261	299	263	263	264	265	101	111	187	111	188	328	328	103	231	331	345	352	350	352	357	368	368	372	387	236	121	237	397	397	396	401	416	422	424	429	441	441	223	255	224	256	208	143	71	144	254	254	53	206	181	207	61	138	51	126	61	127	205	205
11	133	177	137	63	129	139	140	184	279	65	289	21	462	209	150	73	146	152	153	227	305	75	316	211	212	322	230	113	190	232	233	358	367	115	380	257	258	390	267	123	239	269	270	430	440	125	454	139	140	140	15	184	279	55	65	65	288	152	153	25	227	305	304	75	315	211	212	212	229	322	230	103	230	113	113	232	233	233	351	358	367	105	115	257	258	266	390	267	396	267	123	269	270	423	430	440	439	150	73	73	225	21	462	23	209	150	223	137	63	63	182	133	63	11	133	13	177	137	53
51	61	204	205	206	207	183	218	219	220	221	222	208	71	253	254	255	256	226	261	262	263	264	265	101	111	323	328	332	338	345	352	359	368	374	381	387	121	391	397	402	408	416	424	431	441	448	455	130	272	15	140	141	278	279	283	284	289	147	25	153	154	303	305	310	316	179	187	229	212	213	189	230	328	331	332	191	350	351	233	234	366	367	373	214	266	258	259	238	267	397	402	240	423	270	271	438	440	254	151	255	146	135	23	462	464	145	150	205	138	206	129	126	181	1	13	133	134	128	137
2	8	474	28	157	52	4	10	275	30	285	54	136	18	465	169	172	215	295	20	300	306	312	317	180	201	198	78	333	102	346	353	360	80	375	104	217	250	247	398	403	409	417	425	432	442	449	456	29	39	34	34	277	59	281	287	286	200	296	44	44	302	69	308	314	249	77	87	82	82	326	107	329	78	334	333	79	89	84	84	363	109	370	376	389	92	92	394	117	399	398	403	420	94	94	435	119	444	169	243	172	241	164	42	42	467	67	469	28	194	157	192	37	163	27	32	32	477	57	478
7	12	475	33	58	155	9	14	159	35	60	290	17	22	466	43	68	170	19	24	174	45	70	318	196	216	324	83	108	339	347	354	361	85	110	382	245	260	392	93	118	410	418	426	433	95	120	457	158	167	273	39	276	282	59	64	40	292	173	298	49	301	309	69	74	320	81	86	197	87	325	330	107	83	88	108	349	356	355	89	362	371	109	90	91	246	97	393	400	117	93	118	421	427	99	434	445	119	43	72	68	244	41	463	47	165	470	67	33	62	58	195	36	38	31	473	37	476	162	57
6	473	476	131	38	479	132	273	276	280	40	291	16	463	165	148	48	166	149	298	301	307	50	319	193	197	325	202	88	340	203	355	362	369	90	383	242	246	393	251	98	411	252	427	434	443	100	458	9	14	167	10	199	35	30	60	64	54	19	175	20	248	45	306	70	317	196	216	86	201	106	83	78	202	112	88	347	354	356	353	365	85	80	114	245	96	250	116	93	398	251	98	418	428	425	437	95	442	148	68	48	215	17	46	18	66	43	169	131	58	38	52	12	62	7	36	8	56	33	28
26	32	477	478	163	192	156	34	277	281	286	200	161	42	467	469	471	241	171	44	302	308	313	249	76	82	326	329	334	341	348	84	363	370	376	384	388	92	394	399	404	412	419	94	435	444	450	459	4	10	39	273	168	30	280	285	287	291	295	49	298	176	306	307	312	319	180	201	87	197	327	78	202	329	335	334	346	353	89	355	364	80	369	377	217	97	246	395	398	251	399	404	417	99	427	436	442	443	469	172	471	166	136	47	463	468	169	148	478	157	163	479	8	194	2	37	473	160	28	131
27	37	160	57	194	195	29	39	168	59	287	292	164	47	468	67	243	244	296	49	176	69	314	320	77	87	327	107	335	342	79	89	364	109	377	385	389	97	395	117	405	413	420	99	436	119	451	460	156	34	10	167	275	281	282	286	285	293	171	20	175	300	308	309	313	321	76	82	201	86	198	329	330	107	333	335	348	84	353	356	360	370	371	375	388	250	96	247	399	400	117	405	419	425	428	432	444	445	67	471	243	472	161	18	46	465	469	470	57	163	194	480	32	157	26	8	36	474	478	162
31	36	56	162	62	480	158	167	199	282	64	293	41	46	66	470	72	472	173	175	248	309	74	321	81	86	106	330	112	343	349	356	365	371	114	386	91	96	116	400	122	414	421	428	437	445	124	461	132	273	14	14	159	280	35	40	60	290	149	24	24	174	307	45	50	318	193	197	216	216	324	202	83	330	108	112	203	355	354	354	361	369	85	110	242	260	260	392	251	93	400	122	252	426	426	433	443	95	470	48	72	170	16	22	22	466	148	43	162	38	62	155	473	58	6	12	12	475	131	33
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	274	294	219	278	222	284	289	350	228	191	299	262	303	265	311	316	422	240	188	235	323	189	338	331	190	191	406	234	357	415	359	366	381	373	380	452	237	391	238	408	401	239	240	271	429	431	438	455	447	454	147	236	154	214	144	253	145	256	224	146	130	187	141	179	142	210	127	204	128	207	181	129
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	141	147	141	279	185	283	288	351	315	344	154	154	305	228	310	315	423	415	213	214	213	230	336	231	337	232	407	359	234	240	234	367	378	372	379	453	259	259	267	406	268	407	269	431	271	271	440	452	446	453	152	266	262	235	464	464	150	210	151	225	139	229	219	186	135	225	134	134	137	178	138	182
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	184	226	274	220	289	221	222	233	316	232	227	299	263	316	264	265	270	269	322	387	188	328	190	332	338	345	239	358	358	416	357	368	380	374	381	454	390	237	397	239	402	408	416	430	430	429	441	454	448	455	226	258	227	257	209	144	254	146	255	256	183	212	184	211	208	146	177	127	205	129	206	207
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	219	152	184	55	288	65	185	352	265	345	262	227	304	315	75	228	424	416	323	257	322	103	337	113	336	344	408	357	359	269	358	105	379	115	378	455	391	390	396	407	123	406	415	429	431	430	439	453	125	452	294	121	299	387	253	209	223	225	73	210	5	111	274	101	21	256	204	177	53	182	63	178
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	275	295	168	280	200	285	290	353	317	346	300	176	307	249	312	318	425	417	198	217	327	202	341	333	339	203	409	364	360	417	364	369	384	375	382	456	247	395	251	412	403	410	252	436	432	436	443	459	449	457	149	250	176	217	465	468	148	241	172	170	132	201	168	180	136	215	474	160	131	192	157	155
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	159	171	275	282	291	286	292	354	318	347	174	300	309	319	313	320	426	418	324	388	198	330	340	334	342	349	410	365	361	419	360	371	383	376	385	457	392	247	400	411	404	413	421	437	433	432	445	458	450	460	173	260	248	245	466	465	470	166	471	244	158	216	199	196	161	170	475	474	162	479	163	195
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	276	296	277	281	293	287	293	355	319	203	301	302	308	321	314	321	427	252	325	389	326	329	343	335	343	348	411	361	362	420	363	370	386	377	386	458	393	394	399	414	405	414	419	433	434	435	444	461	451	461	171	246	174	242	165	467	469	472	243	472	156	197	159	193	164	166	476	477	478	480	194	480
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	277	19	199	30	292	60	291	84	249	348	302	248	306	320	70	319	94	419	326	245	106	78	342	108	340	346	412	360	363	418	365	80	385	110	383	459	394	116	398	413	118	411	417	432	435	437	442	460	120	458	295	92	300	388	467	66	169	244	68	166	4	82	275	76	17	241	477	56	28	195	58	479
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	168	149	159	35	54	40	54	89	320	79	176	174	45	317	50	317	99	420	327	242	324	83	102	88	102	347	413	363	364	252	361	85	104	90	104	460	395	392	93	409	98	409	418	435	436	433	95	456	100	456	19	97	302	389	468	466	43	215	48	215	9	87	277	77	16	244	160	475	33	52	38	52
0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	199	173	276	59	290	64	200	356	321	349	248	301	69	318	74	249	428	421	106	91	325	107	339	112	341	79	414	362	365	421	362	109	382	114	384	461	116	393	117	410	122	412	420	434	437	434	119	457	124	459	296	96	301	91	66	165	67	170	72	241	29	86	276	81	41	472	56	476	57	155	62	192]';

numnp = size(nodes,1);
numel = 48;
% elements(numel+1:end,:) = elements(numel+1:end,...
%    [2,1,3,4,5,7,6,9,8,10,13,12,11,14,16,15,17,20,19,18]);
[BC, FORCE] = generateBC(BC_T, FORCE_Tx, nodes, elements, eltype, ndm, numnp, numel);
RegionOnElement = [...
   3*ones(6 ,1)
   1*ones(6 ,1)
   2*ones(6 ,1)
   1*ones(30,1)
   4*ones(50,1)
   5*ones(4 ,1)
   6*ones(6 ,1)
   7*ones(4 ,1)
   8*ones(2 ,1)
   9*ones(6 ,1)];
elements = [elements,RegionOnElement];
material = [...
   1
   1
   1
   8
   8
   8
   8
   8
   8];
props = {...
   {'E', 190e3; 'nu', 0.30}
   {'E', 190e3; 'nu', 0.30}
   {'E', 190e3; 'nu', 0.30}
   {'L', 1; 'R', 1}
   {'L', 2; 'R', 1}
   {'L', 2; 'R', 2}
   {'L', 3; 'R', 1}
   {'L', 3; 'R', 2}
   {'L', 3; 'R', 3}};

ndof = 3;
numeq = ndof*numnp;